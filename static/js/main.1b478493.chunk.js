(this.webpackJsonptemplate_react=this.webpackJsonptemplate_react||[]).push([[0],{102:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n.n(r),s=n(48),o=n.n(s),c=(n(90),n(71),n(7)),u=n(4),i=n.n(u),p=n(14),l=n(11),d=n(12),f=n(58),j=n(57),h=n(132),b=n(134),v=n(135),x=n(77),O=n.n(x),g=n(55),m=n.n(g),S=n(133),y=n(56),k=function(){function t(){Object(l.a)(this,t)}return Object(d.a)(t,null,[{key:"toRadians",value:function(t){return t*Math.PI/180}},{key:"getDistance",value:function(e,n){var r=Object(c.a)(e,2),a=r[0],s=r[1],o=Object(c.a)(n,2),u=o[0],i=o[1],p=[t.toRadians(u-a),t.toRadians(i-s)],l=p[0],d=p[1],f=[t.toRadians(a),t.toRadians(u)],j=f[0],h=f[1],b=Math.sin(l/2)*Math.sin(l/2)+Math.sin(d/2)*Math.sin(d/2)*Math.cos(j)*Math.cos(h);return 6371*(2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b)))}}]),t}(),I=function(){function t(){Object(l.a)(this,t)}return Object(d.a)(t,null,[{key:"getStopsIndex",value:function(){var t=Object(p.a)(i.a.mark((function t(){var e;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"/bus_lk_app/data/stops.json",t.next=3,y.a.json("/bus_lk_app/data/stops.json");case 3:return e=t.sent,t.abrupt("return",Object.values(e).reduce((function(t,e){var n=e.stop_id,r=e.name,a=e.global_code,s=e.lat_lng;return t[n]={stopID:n,name:r,globalCode:a,latLng:s},t}),{}));case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"getClosestStops",value:function(){var e=Object(p.a)(i.a.mark((function e(n){var r,a,s,o,u,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=function(t){var e=Object(c.a)(t,2),n=e[0],r=e[1];return k.getDistance([a,s],[n,r])},r=Object(c.a)(n,2),a=r[0],s=r[1],e.next=4,t.getStopsIndex();case 4:return o=e.sent,p=Object.values(o).map((function(t){return t.distance=u(t.latLng),t})),e.abrupt("return",p.sort((function(t,e){return t.distance-e.distance})));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),t}(),M=["100-S","103-S","120-S","125-S","135-S","138-S","140-S","154-S","155-S","163-S","166-S","168-S","176-S","177-W","193-S"],w=function(){function t(){Object(l.a)(this,t)}return Object(d.a)(t,null,[{key:"getRouteStopIDs",value:function(){var t=Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(M.map(function(){var t=Object(p.a)(i.a.mark((function t(e){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n="/bus_lk_app/data/routes/".concat(e,".json"),t.next=3,y.a.json(n);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()},{key:"getRoutesIndex",value:function(){var e=Object(p.a)(i.a.mark((function e(){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRouteStopIDs();case 2:return n=e.sent,e.abrupt("return",M.reduce((function(t,e,r){return t[e]=n[r],t}),{}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getRoutesForStops",value:function(){var e=Object(p.a)(i.a.mark((function e(n){var r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRoutesIndex();case 2:return r=e.sent,a=new Set,e.abrupt("return",n.reduce((function(t,e){for(var n=e.stopID,s=0,o=Object.entries(r);s<o.length;s++){var u=Object(c.a)(o[s],2),i=u[0],p=u[1];if(!a.has(i)){var l=p.findIndex((function(t){return t===n}));-1!==l&&(t.push({routeID:i,routeStopIDs:p,closestStopIndex:l,closestStopID:n,closestStopName:e.name,closestStopLatLng:e.latLng,distance:e.distance}),a.add(i))}}return t}),[]));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getStopIDToRouteIDs",value:function(){var e=Object(p.a)(i.a.mark((function e(n){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRoutesIndex();case 2:return r=e.sent,e.abrupt("return",Object.entries(r).reduce((function(t,e){var n=Object(c.a)(e,2),r=n[0];return n[1].reduce((function(t,e){return t[e]||(t[e]=[]),t[e].push(r),t}),t)}),{}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),t}(),L=n(136),D=n(139),C=n(140),R=n(141),P=n(142),F=n(1);function _(t){var e=t.routeID,n=t.shortFormat,r=e.substring(0,3),a=e.substring(4,5),s=n?" \xb7 ":function(t){switch(t){case"N":return"Northbound";case"S":return"Southbound";case"E":return"Eastbound";case"W":return"Westbound";default:return}}(a),o=function(t){switch(parseInt(t.substring(0,2))){case 12:return"red";case 13:return"orange";case 14:return"blue";case 15:return"brown";case 16:return"purple";case 17:return"green";default:return"gray"}}(r);return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(P.a,{variant:"h6",component:"span",sx:{color:o},children:r}),Object(F.jsx)(P.a,{variant:"caption",component:"span",children:" "+s})]})}var z=n(75),E=n.n(z);function N(t){var e=function(t){if(t<1){var e=10*Math.round(100*t,0);return"".concat(e.toFixed(0)," m")}return"".concat(t<10?t.toFixed(1):t.toFixed(0)," km")}(t.distanceKM);return Object(F.jsx)(P.a,{variant:"subtitle2",component:"span",sx:{color:"gray"},children:e})}function B(t){var e=t.distanceKM,n=Math.ceil(60*e/4.5);return Object(F.jsxs)(P.a,{variant:"subtitle2",component:"span",children:[n," min",Object(F.jsx)(E.a,{sx:{height:14}})]})}function K(t){var e=t.distanceKM;return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)(N,{distanceKM:e})," \xb7 ",Object(F.jsx)(B,{distanceKM:e})]})}var U=n(76),T=n.n(U);function V(t){var e=t.stopName,n=t.size,r=t.prefix;return e=(e=e.replace(" Bus Stop","")).replace(" Bus Station",""),Object(F.jsxs)(P.a,{component:"div",sx:{fontSize:n},children:[r,Object(F.jsx)(T.a,{sx:{height:n}}),e]})}function W(t){var e=t.route,n=t.stopsIndex,r=t.onUpdateLatLng,a=e.distance<=1.1?1:.5,s=e.routeStopIDs.length,o=n[e.routeStopIDs[s-1]].name;return Object(F.jsxs)(D.a,{onClick:function(){r(e.closestStopLatLng)},sx:{opacity:a},children:[Object(F.jsx)(C.a,{children:Object(F.jsx)(m.a,{})}),Object(F.jsxs)(R.a,{children:[Object(F.jsx)(_,{routeID:e.routeID}),Object(F.jsx)(V,{stopName:e.closestStopName,size:20,prefix:""}),Object(F.jsx)(V,{stopName:o,size:10,prefix:"to"}),Object(F.jsx)(K,{distanceKM:e.distance})]})]})}function q(t){var e=t.routes,n=t.stopsIndex,r=t.onUpdateLatLng;return Object(F.jsx)(L.a,{children:e.map((function(t,e){return Object(F.jsx)(W,{route:t,stopsIndex:n,onUpdateLatLng:r},"route-".concat(e))}))})}var G=n(126),J=n(127),Z=n(137),A=n(138),H={centerCircle:{color:"red",stroke:null,fillOpacity:.25,radius:100},stopCircle:{color:"black",fillOpacity:.5,stroke:null,radius:10}};n(99);function Q(t){return Object(G.a)({moveend:function(e){t.onMoveEnd(e)}}),null}var X=function(t){Object(f.a)(n,t);var e=Object(j.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var t=this.props,e=t.center,n=t.zoom,r=t.onMoveEnd;return Object(F.jsxs)(J.a,{center:e,zoom:n,zoomControl:!1,children:[Object(F.jsx)(Z.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),Object(F.jsx)(Q,{onMoveEnd:r}),this.props.children,Object(F.jsx)(A.a,{center:e,radius:H.centerCircle.radius,pathOptions:H.centerCircle})]})}}]),n}(r.Component);function Y(t){var e=t.stop;return Object(F.jsx)(A.a,{center:e.latLng,radius:H.stopCircle.radius,pathOptions:H.stopCircle})}var $=0,tt=1,et=function(t){Object(f.a)(n,t);var e=Object(j.a)(n);function n(t){var r;return Object(l.a)(this,n),(r=e.call(this,t)).state={isDataLoaded:!1,navigationPaneValue:$},r}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var t=Object(p.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:navigator.geolocation.getCurrentPosition(this.onGetCurrentPosition.bind(this));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"updateMapPosition",value:function(){var t=Object(p.a)(i.a.mark((function t(e,n){var r,a,s,o;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I.getClosestStops(e);case 2:return r=t.sent,t.next=5,I.getStopsIndex();case 5:return a=t.sent,t.next=8,w.getRoutesForStops(r);case 8:return s=t.sent,t.next=11,w.getStopIDToRouteIDs();case 11:o=t.sent,this.setState({zoom:n,latLng:e,closestStops:r,stopsIndex:a,routesForStops:s,stopIDToRouteIDs:o,isDataLoaded:!0,navigationPaneValue:$});case 13:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"onUpdateLatLng",value:function(){var t=Object(p.a)(i.a.mark((function t(e){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.updateMapPosition(e,18);case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"onGetCurrentPosition",value:function(){var t=Object(p.a)(i.a.mark((function t(e){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[e.coords.latitude,e.coords.longitude],18,t.next=4,this.updateMapPosition(n,18);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"onMoveEnd",value:function(){var t=Object(p.a)(i.a.mark((function t(e){var n,r,a;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.target.getCenter(),r=[n.lat,n.lng],a=e.target.getZoom(),t.next=5,this.updateMapPosition(r,a);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"onChangeBottomNavigation",value:function(t,e){this.setState({navigationPaneValue:e})}},{key:"renderMap",value:function(){var t=this.state,e=t.latLng,n=t.closestStops,r=Object(c.a)(e,2),a=r[0],s=r[1];return Object(F.jsx)(X,{center:[a,s],zoom:18,onMoveEnd:this.onMoveEnd.bind(this),children:n.map((function(t,e){return Object(F.jsx)(Y,{stop:t},"stop-circle-".concat(e))}))})}},{key:"renderRoutes",value:function(){var t=this.state,e=t.routesForStops,n=t.stopsIndex;return Object(F.jsx)(q,{routes:e,stopsIndex:n,onUpdateLatLng:this.onUpdateLatLng.bind(this)})}},{key:"renderInner",value:function(){switch(this.state.navigationPaneValue){case $:return this.renderMap();case tt:return this.renderRoutes();default:return null}}},{key:"render",value:function(){var t=this.state,e=t.isDataLoaded,n=t.navigationPaneValue;return e?Object(F.jsxs)(h.a,{children:[Object(F.jsx)(h.a,{sx:{paddingBottom:10},elevation:2,children:this.renderInner()}),Object(F.jsx)(S.a,{sx:{position:"fixed",bottom:0,left:0,right:0,height:60},elevation:1,children:Object(F.jsxs)(b.a,{showLabels:!0,onChange:this.onChangeBottomNavigation.bind(this),value:n,children:[Object(F.jsx)(v.a,{label:"Map",icon:Object(F.jsx)(O.a,{})}),Object(F.jsx)(v.a,{label:"Routes",icon:Object(F.jsx)(m.a,{})})]})})]}):"Loading..."}}]),n}(r.Component),nt=n(78),rt=n(131),at=Object(nt.a)({typography:{fontFamily:["Lato","sans-serif"].join(",")}});var st=function(){return Object(F.jsx)(rt.a,{theme:at,children:Object(F.jsx)(et,{})})},ot=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,143)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,s=e.getLCP,o=e.getTTFB;n(t),r(t),a(t),s(t),o(t)}))};o.a.render(Object(F.jsx)(a.a.StrictMode,{children:Object(F.jsx)(st,{})}),document.getElementById("root")),ot()},71:function(t,e,n){},90:function(t,e,n){},99:function(t,e,n){}},[[102,1,2]]]);
//# sourceMappingURL=main.1b478493.chunk.js.map